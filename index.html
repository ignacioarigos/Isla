<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calendario de Asignaciones</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      color: #222;
      padding: 20px;
    }
    #calendario {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-top: 10px;
    }
    .dia {
      padding: 8px;
      text-align: center;
      border-radius: 6px;
      cursor: pointer;
    }
    .vacaciones { background-color: #007acc; color: white; }
    .bloque2    { background-color: #ffaa00; color: black; }
    .bloque3    { background-color: #88cc00; color: black; }
    .bloque4    { background-color: #cc66cc; color: white; }
    .no-asignado { background-color: #ddd; color: #666; }
    #resultado {
      margin-top: 15px;
      padding: 10px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #mesControles {
      margin-top: 10px;
    }
    #mesControles button {
      padding: 6px 10px;
      margin: 0 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Calendario de Asignaciones</h1>
  <div id="mesControles">
    <button onclick="mesAnterior()">◀</button>
    <span id="mesActual"></span>
    <button onclick="mesSiguiente()">▶</button>
  </div>
  <div id="calendario"></div>
  <div id="resultado"></div>

<script>
const bloques = [
  {
    nombre: "Vacaciones",
    prioridad: 1,
    clase: "vacaciones",
    asignaciones: [
      { inicio: "2025-01-02", fin: "2025-01-16", nombre: "Eugenia" },
      { inicio: "2025-01-17", fin: "2025-01-31", nombre: "Malvina" },
      { inicio: "2025-02-01", fin: "2025-02-15", nombre: "Enrique" },
      { inicio: "2025-02-16", fin: "2025-03-02", nombre: "Ramón" }
    ]
  },
  {
    nombre: "Bloque 2",
    prioridad: 4,
    clase: "bloque2",
    asignaciones: [
      { inicio: "2025-08-07", fin: "2025-08-13", nombre: "Eugenia" },
      { inicio: "2025-08-14", fin: "2025-08-20", nombre: "Malvina" },
      { inicio: "2025-08-21", fin: "2025-08-27", nombre: "Enrique" },
      { inicio: "2025-08-28", fin: "2025-09-03", nombre: "Ramón" },
      { inicio: "2025-09-04", fin: "2025-09-10", nombre: "Malvina" },
      { inicio: "2025-09-11", fin: "2025-09-17", nombre: "Eugenia" }
    ]
  },
  {
    nombre: "Bloque 3",
    prioridad: 2,
    clase: "bloque3",
    asignaciones: [
      { inicio: "2025-07-01", fin: "2025-07-15", nombre: "Enrique" },
      { inicio: "2025-07-16", fin: "2025-07-31", nombre: "Ramón" },
      { inicio: "2025-10-01", fin: "2025-10-15", nombre: "Malvina" },
      { inicio: "2025-10-16", fin: "2025-10-31", nombre: "Eugenia" }
    ]
  },
  {
    nombre: "Bloque 4",
    prioridad: 3,
    clase: "bloque4",
    asignaciones: [
      { inicio: "2025-12-20", fin: "2025-12-31", nombre: "Malvina" },
      { inicio: "2026-01-01", fin: "2026-01-10", nombre: "Eugenia" },
      { inicio: "2026-01-11", fin: "2026-01-20", nombre: "Ramón" },
      { inicio: "2026-01-21", fin: "2026-01-31", nombre: "Enrique" },
      { inicio: "2026-02-01", fin: "2026-02-14", nombre: "Malvina" },
      { inicio: "2026-02-15", fin: "2026-02-28", nombre: "Eugenia" }
    ]
  }
];

const fechaInicio = new Date("2025-01-01");
const fechaFin = new Date("2026-03-31");
let mesActual = new Date("2025-01-01");

function mesAnterior() {
  mesActual.setMonth(mesActual.getMonth() - 1);
  renderizarCalendario();
}

function mesSiguiente() {
  mesActual.setMonth(mesActual.getMonth() + 1);
  renderizarCalendario();
}

function extenderBloque2(fecha) {
  const diaSemana = fecha.getDay(); // jueves = 4
  const diferencia = (diaSemana >= 4) ? diaSemana - 4 : 7 - (4 - diaSemana);
  const inicio = new Date(fecha);
  inicio.setDate(fecha.getDate() - diferencia);
  const fin = new Date(inicio);
  fin.setDate(inicio.getDate() + 6);
  return [inicio, fin];
}

function renderizarCalendario() {
  const calendario = document.getElementById("calendario");
  const mesLabel = document.getElementById("mesActual");
  calendario.innerHTML = "";

  const year = mesActual.getFullYear();
  const month = mesActual.getMonth();
  mesLabel.textContent = mesActual.toLocaleDateString("es-AR", { year: "numeric", month: "long" });

  const primerDia = new Date(year, month, 1);
  const ultimoDia = new Date(year, month + 1, 0);
  const offset = primerDia.getDay();

  for (let i = 0; i < offset; i++) {
    const celdaVacia = document.createElement("div");
    calendario.appendChild(celdaVacia);
  }

  for (let d = 1; d <= ultimoDia.getDate(); d++) {
    const fecha = new Date(year, month, d);
    if (fecha < fechaInicio || fecha > fechaFin) continue;

    const dia = document.createElement("div");
    dia.classList.add("dia");

    let asignado = null;
    let prioridadActual = Infinity;

    bloques.forEach(bloque => {
      bloque.asignaciones.forEach(asignacion => {
        let inicio = new Date(asignacion.inicio);
        let fin = new Date(asignacion.fin);

        // Solo extender rango si la fecha pertenece al bloque 2
        if (bloque.nombre === "Bloque 2" && fecha >= inicio && fecha <= fin) {
          const rangoExtendido = extenderBloque2(inicio);
          inicio = rangoExtendido[0];
          fin = rangoExtendido[1];
        }

        if (fecha >= inicio && fecha <= fin && bloque.prioridad < prioridadActual) {
          asignado = {
            nombre: asignacion.nombre,
            clase: bloque.clase,
            bloque: bloque.nombre,
            desde: asignacion.inicio,
            hasta: asignacion.fin
          };
          prioridadActual = bloque.prioridad;
        }
      });
    });

    if (asignado) {
      dia.classList.add(asignado.clase);
      dia.onclick = () => {
        document.getElementById("resultado").innerHTML =
          `<strong>${asignado.nombre}</strong> está asignado en <strong>${asignado.bloque}</strong><br>Del <strong>${asignado.desde}</strong> al <strong>${asignado.hasta}</strong>`;
      };
    } else {
      dia.classList.add("no-asignado");
    }

    dia.textContent = d;
    calendario.appendChild(dia);
  }

  // Fin del renderizado
}

renderizarCalendario();
</script>
</body>
</html>
