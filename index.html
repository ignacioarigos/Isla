<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendario Asignaciones</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 900px;
  }
  th, td {
    border: 1px solid #999;
    padding: 6px;
    text-align: center;
    cursor: pointer;
    user-select: none;
  }
  th {
    background: #eee;
  }
  td.asignado {
    color: white;
  }
  /* Colores para cada persona */
  td.Eugenia { background: #ff6f61; }
  td.Malvina { background: #6fa8dc; }
  td.Enrique { background: #93c47d; }
  td.Ramón { background: #f9cb9c; }
  td.vacaciones {
    background: #bbb;
    color: #444;
    cursor: default;
  }
  td.seleccionado {
    outline: 3px solid #333;
  }
</style>
</head>
<body>

<h2>Calendario Interactivo de Asignaciones</h2>
<p>Haz clic en una celda para ver la asignación. Bloque 2 tiene asignación de jueves a miércoles.</p>

<table id="calendario">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Día</th>
      <th>Asignado</th>
    </tr>
  </thead>
  <tbody id="tbody-calendario">
    <!-- Aquí se llenará con JS -->
  </tbody>
</table>

<script>
  // Datos de asignaciones (ejemplo)
  // Bloques con fechas y asignados en orden cíclico (Eugenia, Malvina, Enrique, Ramón)
  // Vacaciones no asignan persona (vacaciones = 'vacaciones')

  // Asignaciones por bloque, ejemplo
  // Bloque 1, fechas fijas
  // Bloque 2, jueves a miércoles
  // Bloques 3 y 4 fechas fijas

  // Para demo, fechas de agosto 2025

  const bloques = [
    {
      nombre: "Bloque 1",
      fechas: ["2025-08-01", "2025-08-02", "2025-08-03"], // ejemplo
      asignados: ["Eugenia", "Malvina", "Enrique"]
    },
    {
      nombre: "Bloque 2",
      // Bloque 2 cubre del jueves al miércoles siguiente para cada asignación
      fechas: [
        // Del 7/8 (jueves) al 13/8 (miércoles)
        { inicio: "2025-08-07", fin: "2025-08-13", asignado: "Ramón" },
        { inicio: "2025-08-14", fin: "2025-08-20", asignado: "Eugenia" },
        { inicio: "2025-08-21", fin: "2025-08-27", asignado: "Malvina" },
        { inicio: "2025-08-28", fin: "2025-09-03", asignado: "Enrique" }
      ]
    },
    {
      nombre: "Bloque 3",
      fechas: ["2025-08-04", "2025-08-05", "2025-08-06"],
      asignados: ["Ramón", "vacaciones", "Malvina"]
    }
  ];

  // Personas con colores para clase CSS
  const personas = ["Eugenia", "Malvina", "Enrique", "Ramón", "vacaciones"];

  // Función para crear rango de fechas en un array
  function fechasEntre(inicioStr, finStr) {
    const inicio = new Date(inicioStr);
    const fin = new Date(finStr);
    const fechas = [];
    for(let d = new Date(inicio); d <= fin; d.setDate(d.getDate() + 1)) {
      fechas.push(new Date(d));
    }
    return fechas;
  }

  // Función para formatear fecha a yyyy-mm-dd
  function formatFecha(date) {
    const y = date.getFullYear();
    const m = String(date.getMonth() + 1).padStart(2, "0");
    const d = String(date.getDate()).padStart(2, "0");
    return `${y}-${m}-${d}`;
  }

  // Crear listado completo de fechas a mostrar
  // Vamos a juntar todas las fechas de bloques
  function obtenerFechasTotales() {
    const fechasSet = new Set();

    bloques.forEach(bloque => {
      if (bloque.fechas) {
        bloque.fechas.forEach(f => fechasSet.add(f));
      } else if (bloque.fechas instanceof Array) {
        // Ya manejado
      } else if (bloque.fechas && bloque.fechas.length === undefined && bloque.fechas.inicio) {
        // Nada para acá
      }

      if (bloque.nombre === "Bloque 2") {
        bloque.fechas.forEach(rango => {
          fechasEntre(rango.inicio, rango.fin).forEach(fechad => fechasSet.add(formatFecha(fechad)));
        });
      }
    });

    // Convertir a array y ordenar ascendente
    return Array.from(fechasSet).sort();
  }

  // Función para obtener asignado para una fecha dada
  function obtenerAsignado(fechaStr) {
    // Primero, buscar en bloque 2 si la fecha cae en algún rango
    const bloque2 = bloques.find(b => b.nombre === "Bloque 2");
    if (bloque2) {
      for (const rango of bloque2.fechas) {
        if (fechaStr >= rango.inicio && fechaStr <= rango.fin) {
          return rango.asignado;
        }
      }
    }
    // Si no está en bloque 2, buscar en otros bloques
    for (const bloque of bloques) {
      if (bloque.nombre === "Bloque 2") continue;
      if (bloque.fechas && bloque.asignados) {
        const index = bloque.fechas.indexOf(fechaStr);
        if (index !== -1) {
          return bloque.asignados[index];
        }
      }
    }
    // Si no está asignado
    return "";
  }

  // Mostrar calendario
  function mostrarCalendario() {
    const tbody = document.getElementById("tbody-calendario");
    tbody.innerHTML = "";

    const fechasTotales = obtenerFechasTotales();

    fechasTotales.forEach(fechaStr => {
      const tr = document.createElement("tr");
      const fechaObj = new Date(fechaStr);

      // Día de la semana (en español)
      const diasSemana = ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"];
      const diaSemana = diasSemana[fechaObj.getDay()];

      const tdFecha = document.createElement("td");
      tdFecha.textContent = fechaStr;

      const tdDia = document.createElement("td");
      tdDia.textContent = diaSemana;

      const tdAsignado = document.createElement("td");

      const asignado = obtenerAsignado(fechaStr);
      tdAsignado.textContent = asignado !== "vacaciones" ? asignado : "Vacaciones";

      // Asignar clase para color
      if (personas.includes(asignado)) {
        tdAsignado.classList.add(asignado);
        tdAsignado.classList.add("asignado");
      }
      if (asignado === "vacaciones") {
        tdAsignado.classList.add("vacaciones");
      }

      // Click para seleccionar bloque 2 desde jueves a miércoles
      tr.dataset.fecha = fechaStr;
      tr.addEventListener("click", () => onSeleccionarFecha(fechaStr));

      tr.appendChild(tdFecha);
      tr.appendChild(tdDia);
      tr.appendChild(tdAsignado);

      tbody.appendChild(tr);
    });
  }

  // Cuando se selecciona una fecha en el calendario
  function onSeleccionarFecha(fechaStr) {
    // Para el bloque 2, seleccionar el rango jueves a miércoles
    // Si la fecha no está en bloque 2, solo se selecciona la fecha

    // Limpiar selección previa
    document.querySelectorAll("#tbody-calendario tr").forEach(tr => {
      tr.classList.remove("seleccionado");
    });

    // Verificar si fecha está en bloque 2 rango
    const bloque2 = bloques.find(b => b.nombre === "Bloque 2");
    let rangoSeleccionado = null;

    if (bloque2) {
      for (const rango of bloque2.fechas) {
        if (fechaStr >= rango.inicio && fechaStr <= rango.fin) {
          rangoSeleccionado = rango;
          break;
        }
      }
    }

    if (rangoSeleccionado) {
      // Seleccionar todas las filas que estén entre rango.inicio y rango.fin
      document.querySelectorAll("#tbody-calendario tr").forEach(tr => {
        const f = tr.dataset.fecha;
        if (f >= rangoSeleccionado.inicio && f <= rangoSeleccionado.fin) {
          tr.classList.add("seleccionado");
        }
      });
      alert(`Bloque 2 asignado a: ${rangoSeleccionado.asignado}\nDesde ${rangoSeleccionado.inicio} hasta ${rangoSeleccionado.fin}`);
    } else {
      // Solo seleccionar la fila clickeada
      const fila = document.querySelector(`#tbody-calendario tr[data-fecha="${fechaStr}"]`);
      if (fila) fila.classList.add("seleccionado");

      const asignado = obtenerAsignado(fechaStr);
      alert(`Fecha: ${fechaStr}\nAsignado: ${asignado !== "vacaciones" ? asignado : "Vacaciones"}`);
    }
  }

  mostrarCalendario();

</script>

</body>
</html>
